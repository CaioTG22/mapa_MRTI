<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Mapa de Localização</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map { height: 100vh; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // Inicializar o mapa
        var map = L.map('map').setView([-22.833400, -47.052303], 17);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 20
        }).addTo(map);
        var marker = L.marker([-22.833400, -47.052303]).addTo(map);

        // URL do CSV publicado
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQp1KFxGyfWarDq--8hcC-o6K5o5LHcjSuhQFybN_kNCix-HpTDN1d8k-BjdAEDONly8-wHoa8pTuoh/gviz/tq?tqx=out:csv&sheet=Sheet1';

        // Função para buscar e processar os dados do CSV
        async function fetchData() {
            try {
                const response = await fetch(csvUrl);
                const csvData = await response.text();
                const [latitude, longitude] = csvData.split(',').map(Number); // Ajuste se a estrutura for diferente

                if (!isNaN(latitude) && !isNaN(longitude)) {
                    // Atualizar o marcador e o mapa
                    marker.setLatLng([latitude, longitude]);
                    //map.setView([latitude, longitude], 13);
                } else {
                    console.error("Dados inválidos: ", latitude, longitude);
                }
            } catch (error) {
                console.error("Erro ao buscar dados do CSV:", error);
            }
        }

        // Atualizar a cada 5 segundos
        setInterval(fetchData, 5000);
    </script>
</body>
</html>
